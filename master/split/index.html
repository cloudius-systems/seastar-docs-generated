<html lang="en" xml:lang="en">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Nadav Har&#8217;El - nyh@ScyllaDB.com">
  <meta name="author" content="Avi Kivity - avi@ScyllaDB.com">
  <title>Asynchronous Programming with Seastar</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #c4a000; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #000000; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #000000; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #000000; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <style type="text/css">

body {
color: #000000;
background: #FFFFFF;
font-size: 13pt;
line-height: 1.10;
font-family: arial, sans-serif; margin-left: 15pt;
margin-right: 15pt;
text-align: justify;
}

div#header, header {
border-top: 1px solid #aaa;
border-bottom: 1px solid #aaa;
background: #F0F0C0;	margin: 10pt;
margin-left: 10%;
margin-right: 10%;
}

.title {
color: #000000;
margin: 5pt;
text-align: center;
font-family: serif;
font-weight: bold;
font-size: 32pt;
}

.author, .date {
color: #000000;
margin: 0pt;
text-align: center;
font-family: serif;
font-weight: normal;
font-size: 16pt;
}

div#TOC, nav#TOC {
border-top: 1px solid #aaa;
border-bottom: 1px solid #aaa;
background: #F9F9F9;
margin: 10pt;
margin-left: 20%;
margin-right: 20%;
}
h1, h2, h3, h4, h5, h6 {
color: #EE3300;
}
a {
text-decoration: none;
}
a:link, a:visited {
color: #0000CC;	}
a:hover {
color: #CC0000;
text-decoration: underline;
}

code {
background-color: #FFFFFF;



white-space: pre-wrap; 
white-space: -moz-pre-wrap !important; 
white-space: -pre-wrap; 
white-space: -o-pre-wrap; 
word-wrap: break-word; 

}
pre {
padding: 0.5em;
border: 1px dotted #777;
margin-left: 15pt;
margin-right: 15pt;
}
pre, pre > code {
background-color: #f8f8f8;
}

@media print {
body { font-size: 11pt; }
a { color: black; background: transparent; }
pre { border: 1px solid #aaa; }
}
</style>
</head>
<body><header id="title-block-header">
<h1 class="title">Asynchronous Programming with Seastar</h1>
<p class="author">Nadav Har&#8217;El - nyh@ScyllaDB.com</p>
<p class="author">Avi Kivity - avi@ScyllaDB.com</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="1.html#introduction"><span class="toc-section-number">1</span> Introduction</a>
<ul>
<li><a href="1.html#asynchronous-programming"><span class="toc-section-number">1.1</span> Asynchronous programming</a></li>
<li><a href="1.html#seastar"><span class="toc-section-number">1.2</span> Seastar</a></li>
</ul></li>
<li><a href="2.html#getting-started"><span class="toc-section-number">2</span> Getting started</a></li>
<li><a href="3.html#threads-and-memory"><span class="toc-section-number">3</span> Threads and memory</a>
<ul>
<li><a href="3.html#seastar-threads"><span class="toc-section-number">3.1</span> Seastar threads</a></li>
<li><a href="3.html#seastar-memory"><span class="toc-section-number">3.2</span> Seastar memory</a></li>
</ul></li>
<li><a href="4.html#introducing-futures-and-continuations"><span class="toc-section-number">4</span> Introducing futures and continuations</a>
<ul>
<li><a href="4.html#ready-futures"><span class="toc-section-number">4.1</span> Ready futures</a></li>
</ul></li>
<li><a href="5.html#coroutines"><span class="toc-section-number">5</span> Coroutines</a>
<ul>
<li><a href="5.html#lambda-coroutines"><span class="toc-section-number">5.1</span> Lambda coroutines</a></li>
<li><a href="5.html#generators-in-coroutines"><span class="toc-section-number">5.2</span> Generators in coroutines</a></li>
<li><a href="5.html#exceptions-in-coroutines"><span class="toc-section-number">5.3</span> Exceptions in coroutines</a></li>
<li><a href="5.html#concurrency-in-coroutines"><span class="toc-section-number">5.4</span> Concurrency in coroutines</a></li>
<li><a href="5.html#breaking-up-long-running-computations"><span class="toc-section-number">5.5</span> Breaking up long running computations</a></li>
<li><a href="5.html#bypassing-preemption-checks-in-coroutines"><span class="toc-section-number">5.6</span> Bypassing preemption checks in coroutines</a></li>
</ul></li>
<li><a href="6.html#continuations"><span class="toc-section-number">6</span> Continuations</a>
<ul>
<li><a href="6.html#capturing-state-in-continuations"><span class="toc-section-number">6.1</span> Capturing state in continuations</a></li>
<li><a href="6.html#evaluation-order-considerations-c14-only"><span class="toc-section-number">6.2</span> Evaluation order considerations (C++14 only)</a></li>
<li><a href="6.html#chaining-continuations"><span class="toc-section-number">6.3</span> Chaining continuations</a></li>
</ul></li>
<li><a href="7.html#handling-exceptions"><span class="toc-section-number">7</span> Handling exceptions</a>
<ul>
<li><a href="7.html#exceptions-vs.-exceptional-futures"><span class="toc-section-number">7.1</span> Exceptions vs.&#160;exceptional futures</a></li>
</ul></li>
<li><a href="8.html#lifetime-management"><span class="toc-section-number">8</span> Lifetime management</a>
<ul>
<li><a href="8.html#passing-ownership-to-continuation"><span class="toc-section-number">8.1</span> Passing ownership to continuation</a></li>
<li><a href="8.html#keeping-ownership-at-the-caller"><span class="toc-section-number">8.2</span> Keeping ownership at the caller</a></li>
<li><a href="8.html#sharing-ownership-reference-counting"><span class="toc-section-number">8.3</span> Sharing ownership (reference counting)</a></li>
<li><a href="8.html#saving-objects-on-the-stack"><span class="toc-section-number">8.4</span> Saving objects on the stack</a></li>
</ul></li>
<li><a href="9.html#advanced-futures"><span class="toc-section-number">9</span> Advanced futures</a>
<ul>
<li><a href="9.html#futures-and-interruption"><span class="toc-section-number">9.1</span> Futures and interruption</a></li>
<li><a href="9.html#futures-are-single-use"><span class="toc-section-number">9.2</span> Futures are single use</a></li>
</ul></li>
<li><a href="10.html#fibers"><span class="toc-section-number">10</span> Fibers</a></li>
<li><a href="11.html#loops"><span class="toc-section-number">11</span> Loops</a>
<ul>
<li><a href="11.html#repeat"><span class="toc-section-number">11.1</span> repeat</a></li>
<li><a href="11.html#do_until"><span class="toc-section-number">11.2</span> do_until</a></li>
<li><a href="11.html#do_for_each"><span class="toc-section-number">11.3</span> do_for_each</a></li>
<li><a href="11.html#parallel_for_each"><span class="toc-section-number">11.4</span> parallel_for_each</a></li>
<li><a href="11.html#max_concurrent_for_each"><span class="toc-section-number">11.5</span> max_concurrent_for_each</a></li>
</ul></li>
<li><a href="12.html#when_all-waiting-for-multiple-futures"><span class="toc-section-number">12</span> when_all: Waiting for multiple futures</a></li>
<li><a href="13.html#semaphores"><span class="toc-section-number">13</span> Semaphores</a>
<ul>
<li><a href="13.html#limiting-parallelism-with-semaphores"><span class="toc-section-number">13.1</span> Limiting parallelism with semaphores</a></li>
<li><a href="13.html#limiting-resource-use"><span class="toc-section-number">13.2</span> Limiting resource use</a></li>
<li><a href="13.html#limiting-parallelism-of-loops"><span class="toc-section-number">13.3</span> Limiting parallelism of loops</a></li>
</ul></li>
<li><a href="14.html#pipes"><span class="toc-section-number">14</span> Pipes</a></li>
<li><a href="15.html#shutting-down-a-service-with-a-gate"><span class="toc-section-number">15</span> Shutting down a service with a gate</a></li>
<li><a href="16.html#introducing-shared-nothing-programming"><span class="toc-section-number">16</span> Introducing shared-nothing programming</a></li>
<li><a href="17.html#more-about-seastars-event-loop"><span class="toc-section-number">17</span> More about Seastar&#8217;s event loop</a></li>
<li><a href="18.html#introducing-seastars-network-stack"><span class="toc-section-number">18</span> Introducing Seastar&#8217;s network stack</a></li>
<li><a href="19.html#sharded-services"><span class="toc-section-number">19</span> Sharded services</a></li>
<li><a href="20.html#shutting-down-cleanly"><span class="toc-section-number">20</span> Shutting down cleanly</a></li>
<li><a href="21.html#command-line-options"><span class="toc-section-number">21</span> Command line options</a>
<ul>
<li><a href="21.html#standard-seastar-command-line-options"><span class="toc-section-number">21.1</span> Standard Seastar command-line options</a></li>
<li><a href="21.html#user-defined-command-line-options"><span class="toc-section-number">21.2</span> User-defined command-line options</a></li>
</ul></li>
<li><a href="22.html#debugging-a-seastar-program"><span class="toc-section-number">22</span> Debugging a Seastar program</a>
<ul>
<li><a href="22.html#debugging-ignored-exceptions"><span class="toc-section-number">22.1</span> Debugging ignored exceptions</a></li>
<li><a href="22.html#finding-where-an-exception-was-thrown"><span class="toc-section-number">22.2</span> Finding where an exception was thrown</a></li>
<li><a href="22.html#debugging-with-gdb"><span class="toc-section-number">22.3</span> Debugging with gdb</a></li>
</ul></li>
<li><a href="23.html#promise-objects"><span class="toc-section-number">23</span> Promise objects</a></li>
<li><a href="24.html#memory-allocation-in-seastar"><span class="toc-section-number">24</span> Memory allocation in Seastar</a>
<ul>
<li><a href="24.html#per-thread-memory-allocation"><span class="toc-section-number">24.1</span> Per-thread memory allocation</a></li>
<li><a href="24.html#foreign-pointers"><span class="toc-section-number">24.2</span> Foreign pointers</a></li>
</ul></li>
<li><a href="25.html#seastarthread"><span class="toc-section-number">25</span> Seastar::thread</a>
<ul>
<li><a href="25.html#starting-and-ending-a-seastarthread"><span class="toc-section-number">25.1</span> Starting and ending a seastar::thread</a></li>
</ul></li>
<li><a href="26.html#isolation-of-application-components"><span class="toc-section-number">26</span> Isolation of application components</a>
<ul>
<li><a href="26.html#scheduling-groups-cpu-scheduler"><span class="toc-section-number">26.1</span> Scheduling groups (CPU scheduler)</a></li>
<li><a href="26.html#latency"><span class="toc-section-number">26.2</span> Latency</a></li>
<li><a href="26.html#disk-io-scheduler"><span class="toc-section-number">26.3</span> Disk I/O scheduler</a></li>
<li><a href="26.html#network-scheduler"><span class="toc-section-number">26.4</span> Network scheduler</a></li>
<li><a href="26.html#controllers"><span class="toc-section-number">26.5</span> Controllers</a></li>
<li><a href="26.html#multi-tenancy"><span class="toc-section-number">26.6</span> Multi-tenancy</a></li>
</ul></li>
</ul>
</nav>
</body></html>