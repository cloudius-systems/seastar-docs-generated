<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Seastar: Execution Stages</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Seastar
   </div>
   <div id="projectbrief">High performance C++ framework for concurrent servers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Execution Stages</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Execution stages provide an infrastructure for processing function calls in batches in order to improve instruction cache locality. </p>
<p>When the application logic becomes more and more complex and the length of the data processing pipeline grows it may happen that the most significant bottleneck are instruction cache misses. The solution for that problem may be processing similar operations in batches so that instruction cache locality is improved at the cost of potentially higher latencies and worse data cache locality.</p>
<p>Execution stages allow batching calls to the specified function object. Every time <a class="el" href="classseastar_1_1concrete__execution__stage.html#a8ae90f114f11600f892b599d7e4a331c">concrete_execution_stage::operator()()</a> is used the function call is added to the queue and a future is returned. Once the number of queued calls reaches certain threshold the stage is flushed and a task is which would execute these function calls is scheduled. Execution stages are also flushed when the reactor polls for events.</p>
<p>When calling a function that is wrapped inside execution stage it is important to remember that the actual function call will happen at some later time and it has to be guaranteed the objects passed by lvalue reference are still alive. In order to avoid accidental passing of a temporary object by lvalue reference the interface of execution stages accepts only lvalue references wrapped in <a class="el" href="classseastar_1_1reference__wrapper.html">reference_wrapper</a>. It is safe to pass rvalue references, they are decayed and the objects are moved. See <a class="el" href="classseastar_1_1concrete__execution__stage.html#a8ae90f114f11600f892b599d7e4a331c">concrete_execution_stage::operator()()</a> for more details. </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classseastar_1_1execution__stage.html">seastar::execution_stage</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base execution stage class.  <a href="classseastar_1_1execution__stage.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classseastar_1_1concrete__execution__stage.html">seastar::concrete_execution_stage&lt; ReturnType, Args &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concrete execution stage class.  <a href="classseastar_1_1concrete__execution__stage.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classseastar_1_1inheriting__execution__stage.html">seastar::inheriting_execution_stage</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Base class for execution stages with support for automatic <a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a> inheritance.  <a href="classseastar_1_1inheriting__execution__stage.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classseastar_1_1inheriting__concrete__execution__stage.html">seastar::inheriting_concrete_execution_stage&lt; ReturnType, Args &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concrete execution stage class, with support for automatic <a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a> inheritance.  <a href="classseastar_1_1inheriting__concrete__execution__stage.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaeb24d9990bf6b8ee2332d2a1652be304"><td class="memTemplParams" colspan="2">template&lt;typename Function &gt; </td></tr>
<tr class="memitem:gaeb24d9990bf6b8ee2332d2a1652be304"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a> (const sstring &amp;name, <a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a> sg, Function &amp;&amp;fn)</td></tr>
<tr class="separator:gaeb24d9990bf6b8ee2332d2a1652be304"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga670deeba65414630039868da3ce09250"><td class="memTemplParams" colspan="2">template&lt;typename Function &gt; </td></tr>
<tr class="memitem:ga670deeba65414630039868da3ce09250"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__execution-stages.html#ga670deeba65414630039868da3ce09250">seastar::make_execution_stage</a> (const sstring &amp;name, Function &amp;&amp;fn)</td></tr>
<tr class="separator:ga670deeba65414630039868da3ce09250"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga966dae2ccffd5487c67cec81847ebf2b"><td class="memTemplParams" colspan="2">template&lt;typename Ret , typename Object , typename... Args&gt; </td></tr>
<tr class="memitem:ga966dae2ccffd5487c67cec81847ebf2b"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classseastar_1_1concrete__execution__stage.html">concrete_execution_stage</a>&lt; Ret, Object *, Args... &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="group__execution-stages.html#ga966dae2ccffd5487c67cec81847ebf2b">seastar::make_execution_stage</a> (const sstring &amp;name, <a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a> sg, Ret(Object::*fn)(Args...))</td></tr>
<tr class="separator:ga966dae2ccffd5487c67cec81847ebf2b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga21489164a564e6c1bee4ff748829ba0b"><td class="memTemplParams" colspan="2"><a id="ga21489164a564e6c1bee4ff748829ba0b"></a>
template&lt;typename Ret , typename Object , typename... Args&gt; </td></tr>
<tr class="memitem:ga21489164a564e6c1bee4ff748829ba0b"><td class="memTemplItemLeft" align="right" valign="top"><a class="el" href="classseastar_1_1concrete__execution__stage.html">concrete_execution_stage</a>&lt; Ret, Object *, Args... &gt;&#160;</td><td class="memTemplItemRight" valign="bottom"><b>seastar::make_execution_stage</b> (const sstring &amp;name, Ret(Object::*fn)(Args...))</td></tr>
<tr class="separator:ga21489164a564e6c1bee4ff748829ba0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga670deeba65414630039868da3ce09250"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga670deeba65414630039868da3ce09250">&#9670;&nbsp;</a></span>make_execution_stage() <span class="overload">[1/3]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Function &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto seastar::make_execution_stage </td>
          <td>(</td>
          <td class="paramtype">const sstring &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Function &amp;&amp;&#160;</td>
          <td class="paramname"><em>fn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new execution stage (variant taking <a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a>)</p>
<p>Wraps given function object in a <a class="el" href="classseastar_1_1concrete__execution__stage.html" title="Concrete execution stage class.">concrete_execution_stage</a>. All arguments of the function object are required to have move constructors that do not throw. Function object may return a future or an immediate object or void.</p>
<p>Moving execution stages is discouraged and illegal after first function call is enqueued.</p>
<p>Usage example: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> do_something(<span class="keywordtype">int</span>);</div>
<div class="line">thread_local <span class="keyword">auto</span> stage1 = <a class="code" href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a>(<span class="stringliteral">&quot;execution-stage1&quot;</span>, do_something);</div>
<div class="line"> </div>
<div class="line">future&lt;double&gt; func1(<span class="keywordtype">int</span> val) {</div>
<div class="line">    <span class="keywordflow">return</span> stage1(val);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">future&lt;double&gt; do_some_io(<span class="keywordtype">int</span>);</div>
<div class="line">thread_local <span class="keyword">auto</span> stage2 = <a class="code" href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a>(<span class="stringliteral">&quot;execution-stage2&quot;</span>, do_some_io);</div>
<div class="line"> </div>
<div class="line">future&lt;double&gt; func2(<span class="keywordtype">int</span> val) {</div>
<div class="line">    <span class="keywordflow">return</span> stage2(val);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__execution-stages_html_gaeb24d9990bf6b8ee2332d2a1652be304"><div class="ttname"><a href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a></div><div class="ttdeci">auto make_execution_stage(const sstring &amp;name, scheduling_group sg, Function &amp;&amp;fn)</div><div class="ttdef"><b>Definition:</b> execution_stage.hh:454</div></div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>unique name of the execution stage (variant not taking <a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a>) </td></tr>
    <tr><td class="paramname">fn</td><td>function to be executed by the stage </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="classseastar_1_1concrete__execution__stage.html" title="Concrete execution stage class.">concrete_execution_stage</a> </dd></dl>

</div>
</div>
<a id="gaeb24d9990bf6b8ee2332d2a1652be304"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaeb24d9990bf6b8ee2332d2a1652be304">&#9670;&nbsp;</a></span>make_execution_stage() <span class="overload">[2/3]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Function &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto seastar::make_execution_stage </td>
          <td>(</td>
          <td class="paramtype">const sstring &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a>&#160;</td>
          <td class="paramname"><em>sg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Function &amp;&amp;&#160;</td>
          <td class="paramname"><em>fn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new execution stage</p>
<p>Wraps given function object in a <a class="el" href="classseastar_1_1concrete__execution__stage.html" title="Concrete execution stage class.">concrete_execution_stage</a>. All arguments of the function object are required to have move constructors that do not throw. Function object may return a future or an immediate object or void.</p>
<p>Moving execution stages is discouraged and illegal after first function call is enqueued.</p>
<p>Usage example: </p><div class="fragment"><div class="line"><span class="keywordtype">double</span> do_something(<span class="keywordtype">int</span>);</div>
<div class="line">thread_local <span class="keyword">auto</span> stage1 = <a class="code" href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a>(<span class="stringliteral">&quot;execution-stage1&quot;</span>, do_something);</div>
<div class="line"> </div>
<div class="line">future&lt;double&gt; func1(<span class="keywordtype">int</span> val) {</div>
<div class="line">    <span class="keywordflow">return</span> stage1(val);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">future&lt;double&gt; do_some_io(<span class="keywordtype">int</span>);</div>
<div class="line">thread_local <span class="keyword">auto</span> stage2 = <a class="code" href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a>(<span class="stringliteral">&quot;execution-stage2&quot;</span>, do_some_io);</div>
<div class="line"> </div>
<div class="line">future&lt;double&gt; func2(<span class="keywordtype">int</span> val) {</div>
<div class="line">    <span class="keywordflow">return</span> stage2(val);</div>
<div class="line">}</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>unique name of the execution stage </td></tr>
    <tr><td class="paramname">sg</td><td>scheduling group to run under </td></tr>
    <tr><td class="paramname">fn</td><td>function to be executed by the stage </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="classseastar_1_1concrete__execution__stage.html" title="Concrete execution stage class.">concrete_execution_stage</a> </dd></dl>

</div>
</div>
<a id="ga966dae2ccffd5487c67cec81847ebf2b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga966dae2ccffd5487c67cec81847ebf2b">&#9670;&nbsp;</a></span>make_execution_stage() <span class="overload">[3/3]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename Ret , typename Object , typename... Args&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classseastar_1_1concrete__execution__stage.html">concrete_execution_stage</a>&lt;Ret, Object*, Args...&gt; seastar::make_execution_stage </td>
          <td>(</td>
          <td class="paramtype">const sstring &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classseastar_1_1scheduling__group.html">scheduling_group</a>&#160;</td>
          <td class="paramname"><em>sg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Ret(Object::*)(Args...)&#160;</td>
          <td class="paramname"><em>fn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Creates a new execution stage from a member function</p>
<p>Wraps a pointer to member function in a <a class="el" href="classseastar_1_1concrete__execution__stage.html" title="Concrete execution stage class.">concrete_execution_stage</a>. When a function call is pushed to the stage the first argument should be a pointer to the object the function is a member of.</p>
<p>Usage example: </p><div class="fragment"><div class="line"><span class="keyword">struct </span>foo {</div>
<div class="line">    <span class="keywordtype">void</span> do_something(<span class="keywordtype">int</span>);</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">thread_local <span class="keyword">auto</span> stage = <a class="code" href="group__execution-stages.html#gaeb24d9990bf6b8ee2332d2a1652be304">seastar::make_execution_stage</a>(<span class="stringliteral">&quot;execution-stage&quot;</span>, &amp;foo::do_something);</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classseastar_1_1future.html">future&lt;&gt;</a> func(foo&amp; obj, <span class="keywordtype">int</span> val) {</div>
<div class="line">    <span class="keywordflow">return</span> stage(&amp;obj, val);</div>
<div class="line">}</div>
<div class="ttc" id="aclassseastar_1_1future_html"><div class="ttname"><a href="classseastar_1_1future.html">seastar::future&lt;&gt;</a></div></div>
</div><!-- fragment --><dl class="section see"><dt>See also</dt><dd><a class="el" href="group__execution-stages.html#ga670deeba65414630039868da3ce09250">make_execution_stage(const sstring&amp;, Function&amp;&amp;)</a> </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>unique name of the execution stage </td></tr>
    <tr><td class="paramname">fn</td><td>member function to be executed by the stage </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="classseastar_1_1concrete__execution__stage.html" title="Concrete execution stage class.">concrete_execution_stage</a> </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
